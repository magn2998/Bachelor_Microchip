<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Secure Boot Management</title>
  <script src="crc32c.js"></script>
  <script src="sha256.js"></script>
  <script src="fwu.js"></script>
  <script src="fwu_app_lan966x_b0.js"></script>
    <style>
	.wrapper {
	    padding: 2px;
	    margin: 2px 2px;
	}
	img#settings {
	    position: absolute;
	    top: 2px;
	    right: 60px;
	}
	img#active {
	    position: absolute;
	    top: 2px;
	    right: 2px;
	}
	textarea {
	    font-size: 12px;
	    width: 100%;
	}
	table {
	    
	    table-layout: fixed;
	}
	table.settings td {
	    border: 1px solid;
	    padding: 5px;
	}
	.feedback {
	    font-style: italic;
	}
	.warning {
	    border: 1px solid;
	    margin: 8px 8px;
	    padding: 8px 8px;
	    text-color: white;
	    background-color: red;
	}
	.memory_config_input {
		width: 100px;
	}
	.memory_test_input {
		width: 25px;
		text-align: center;
		font-weight: bold;
	}
    </style>
</head>
<body onload="startSerial()">
  <h1>LAN966x Secure boot management</h1>
  <img id="settings" width="20" height="20" src="settings.jpg">
  <img id="active" width="30" height="30" src="activity.gif" style="display:none">
  <div id="browser_check" style="display:none" class="warning">
    <h3>Warning!</h3>
    <p>
      You seem not to be using a supported browser. Please use only
      Google 'Chrome' or Microsoft 'Edge' browsers, and if so - a
      current version. This tool will not work otherwise.
    </p>
  </div>
  <div id="connect">
    <h2>Select communication port</h2>
    <p>
      First you need to connect your device to your computer, using an
      USB or RS-232 port as defined by your PC and the device you want
      to manage.
    </p>
    <p>
      You should also make sure your browser support HTML5 and has
      JavaScript enabled. Crome or MS Edge is recommended.
    </p>
    <p>
      You may also wish to enable the JavaScript console for detailed
      insight into device interaction.
    </p>
    <button type="button" id="port_select">Connect device</button>
  </div>
  <div id="bl1" style="display:none">
    <h2>BL1 bootstrap</h2>
    <p>
      You are now in the built-in <i>BL1</i> context, and you may
      select the functions supported here.
    </p>
    <p>
      To perform firmware upgrade, and other functions such as device
      firmware encryption you should change to the <i>BL2U</i>
      context. This implies uploading the associated
      BL2U <samp>fwu_fip</samp> which will then be replacing BL1
      temporarily.
    </p>
    <p>
      Once you have performed the operations desired, you may
      select <samp>Continue Boot</samp> to continue normal system
      boot. Notice however, that to ensure normal boot (next time) you
      need to physically change the device strap settings as desired.
    </p>
    <table>
      <tr>
	<td>
	  <button type="button" id="bl1_download">Download BL2U</button>
	</td>
      </tr>
      <tr>
	<td>
	  <button type="button" id="bl1_sjtag_challenge">SJTAG Get Challenge</button>
	</td>
	<td id="bl1_sjtag_challenge_feedback" class="feedback"></td>
      </tr>
      <tr>
	<td>
	  <button type="button" id="bl1_sjtag_unlock">SJTAG Unlock</button>
	  Key <input id="bl1_sjtag_unlock_key" placeholder="XX:XX:XX:... X=hex digit" type="text" size="16"/>
	</td>
	<td id="bl1_sjtag_unlock_feedback" class="feedback"></td>
      </tr>
      <tr>
	<td>
	  <button type="button" id="bl1_otp_set_rnd">OTP Random</button>
	  <select id="bl1_otp_set_rnd_fld"></select>
	</td>
	<td id="bl1_otp_set_rnd_feedback" class="feedback"></td>
      </tr>
      <tr>
	<td>
	  <button type="button" id="bl1_otp_set_data">OTP Set</button>
	  <select id="bl1_otp_set_data_fld"></select>
	  Data <input id="bl1_otp_set_data_buf" placeholder="XX:XX:XX:... X=hex digit" type="text" size="16"/>
	</td>
	<td id="bl1_otp_set_data_feedback" class="feedback"></td>
      </tr>
      <tr>
	<td>
	  <button type="button" id="bl1_continue">Continue Boot</button>
	</td>
      </tr>
    </table>
  </div>
  <div id="bl2u" style="display:none">
    <h2>BL2U bootstrap</h2>
    <p>
      You are now in the built-in <i>BL2U</i> context, which enables
      firmware associated functions and OTP reading.
    </p>
    <p>
      For firmware update you should start by uploading
      either the <samp>FIP</samp> with a firmware upgrade, or a full
      Flash image.
    </p>
    <p>
      <ul>
	<li>
	  When updating NOR flash there is no distinction between FIP
	  or Flash image. The FIP <i>is</i> the Flash image.
	</li>
	<li>For eMMC/SD the Flash image is a GPT image.</li>
	<li>
	  You may upload <samp>GZIP</samp>'ed files, and they will
	  automatically be unzipped when received.
	</li>
      </ul>
    </p>
    <table>
      <tr>
	<td>
	  <input type="file" id="file_select">
	</td>
      </tr>
      <tr>
	<td>
	<button type="button" id="bl2u_upload">Upload file</button>
	<input type="checkbox" id="binary" checked> Use binary upload
	</td>
      </tr>
      <tr>
	<td>
	  <button type="button" id="bl2u_bind">Bind FIP (BSSK Re-encrypt)</button>
	</td>
	<td id="bl2u_bind_fip_feedback" class="feedback"></td>
      </tr>
      <tr>
	<td>
	  <button type="button" id="bl2u_write_fip">Write FIP Image</button>
	  <select id="bl2u_write_fip_device">
	    <option value="0">eMMC</option>
	    <option value="1">NOR Flash</option>
	    <option value="2">SD Card</option>
	  </select>
	</td>
	<td id="bl2u_write_fip_feedback" class="feedback"></td>
      </tr>
      <tr>
	<td>
	  <button type="button" id="bl2u_write_image">Write Flash Image</button>
	  <select id="bl2u_write_image_device">
	    <option value="0">eMMC</option>
	    <option value="1">NOR Flash</option>
	    <option value="2">SD Card</option>
	  </select>
	</td>
	<td id="bl2u_write_image_feedback" class="feedback"></td>
      </tr>
      <tr>
	<td>
	  <button type="button" id="bl2u_otp_read">OTP Read</button>
	  <select id="bl2u_otp_read_type">
	    <option>Raw</option>
	    <option>Emu</option>
	  </select>
	  <select id="bl2u_otp_read_fld"></select>
	</td>
	<td id="bl2u_otp_read_feedback" class="feedback"></td>
      </tr>
      <tr>
	<td>
	  <button type="button" id="bl2u_otp_set_rnd">OTP Random</button>
	  <select id="bl2u_otp_set_rnd_fld"></select>
	</td>
	<td id="bl2u_otp_set_rnd_feedback" class="feedback"></td>
      </tr>
      <tr>
	<td>
	  <button type="button" id="bl2u_otp_set_data">OTP Set</button>
	  <select id="bl2u_otp_set_data_fld"></select>
	  Data <input id="bl2u_otp_set_data_buf" placeholder="XX:XX:XX:... X=hex digit" type="text" size="16"/>
	</td>
	<td id="bl2u_otp_set_data_feedback" class="feedback"></td>
      </tr>
      <tr>
				<td>
				  <button type="button" id="bl2u_reset">Reset to BL1</button>
				</td>
      </tr>
    </table>

	<div>
		<h2>DDR Memory Configuration</h2>
		<p style="margin:0px;">Enter the configuration parameters below to initialise the DDR memory</p>
		<p style="margin:0 0 20px 0;">Alternatively, you can use the default configuration.</p>

		<table >
			<tr>
				<td><input class="memory_config_input" id="memory_config_parm_1" placeholder="Parameter 1"/></td>
				<td><input class="memory_config_input" id="memory_config_parm_2" placeholder="Parameter 2"/></td>
				<td><input class="memory_config_input" id="memory_config_parm_3" placeholder="Parameter 3"/></td>
				<td><input class="memory_config_input" id="memory_config_parm_4" placeholder="Parameter 4"/></td>
			</tr>
			<tr>
				<td><input class="memory_config_input" id="memory_config_parm_5" placeholder="Parameter 5"/></td>
				<td><input class="memory_config_input" id="memory_config_parm_6" placeholder="Parameter 6"/></td>
				<td><input class="memory_config_input" id="memory_config_parm_7" placeholder="Parameter 7"/></td>
				<td><input class="memory_config_input" id="memory_config_parm_8" placeholder="Parameter 8"/></td>
			</tr>
			<tr>
				<td><input class="memory_config_input" id="memory_config_parm_9" placeholder="Parameter 9"/></td>
				<td><input class="memory_config_input" id="memory_config_parm_10" placeholder="Parameter 10"/></td>
				<td><input class="memory_config_input" id="memory_config_parm_11" placeholder="Parameter 11"/></td>
				<td><input class="memory_config_input" id="memory_config_parm_12" placeholder="Parameter 12"/></td>
			</tr>
			<tr>
				<td><input class="memory_config_input" id="memory_config_parm_13" placeholder="Parameter 13"/></td>
				<td><input class="memory_config_input" id="memory_config_parm_14" placeholder="Parameter 14"/></td>
				<td><input class="memory_config_input" id="memory_config_parm_15" placeholder="Parameter 15"/></td>
				<td><input class="memory_config_input" id="memory_config_parm_16" placeholder="Parameter 16"/></td>
			</tr>
		</table>

		<div style="margin: 20px 0px;">
			<button style="" type="button" id="memory_config_setup_default_btn">Config Default</button>
			<button style="" type="button" id="memory_config_setup_btn">Initialize Memory</button>
		</div>
	</div>

    <div>
    	<h2>DDR Memory Testing</h2>
    	<p style="margin:0px;">Use the buttons below to test the memory of the board.</p>
		<p style="margin:0 0 20px 0;">You can also set amount of repetitions or use reverse patterns too.</p>
    	
    	<table>
			<tr>
			<td><button style="width:100%" type="button" id="memorytest_dataBus">Check Data Bus</button></td>
			<td><input class="memory_test_input" value="1" id="memorytest_dataBus_reps" placeholder="repititions"/></td>
			<td></td>
			</tr>
			<tr>
			<td><button style="width:100%" type="button" id="memorytest_addressBus">Check Address Bus</button></td>
			<td><input class="memory_test_input" value="1" id="memorytest_addrBus_reps" placeholder="repititions"/></td>
			<td></td>
			</tr>
			<tr>
			<td><button style="width:100%" type="button" id="memorytest_chip_rnd">Random Pattern</button></td>
			<td><input class="memory_test_input" value="1" id="memorytest_rnd_reps" placeholder="repititions"/></td>
			<td>
				<input type="checkbox" id="memorytest_chip_rnd_reversed" name="rnd_reversed">
				<label for="rnd_reversed">Reversed</label>
			</td>
			</tr>
			<tr>
			<td><button style="width:100%" type="button" id="memorytest_chip_walkingOnes">Walking Ones</button></td>
			<td><input  class="memory_test_input" value="1" id="memorytest_ones_reps" placeholder="repititions"/></td>
			<td>
				<input type="checkbox" id="memorytest_chip_walkingOnes_reversed" name="walkingOnes_reversed">
				<label for="walkingOnes_reversed">Reversed</label>
			</td>
			</tr>
		</table>


    </div>

  </div>
  <div id="booting" style="display:none">
    <h2>Booting</h2>
    <p>The device is now booting.  Remember to reset device strappings
      for automatic boot at next reset if so desired.
    </p>
  </div>
  <div id="adv_settings" style="display:none">
    <h2>Advanced settings</h2>
    <p>
      These settings are mostly usable for advanced users. Use at own risk.
    </p>
    <table class="settings">
      <tr>
	<td width="20%">
	  Enable trace <input type="checkbox" id="enable_trace">
	</td>
	<td>
	  Enabling this will add detailed trace output of all messages
	  between the managed device in the <i>JavaScript</i> console
	  of your browser. This is typically found in
	  <samp>Settings|Developer Tools</samp> (or F-12 on MS Edge).
	</td>
      </tr>
    </table>
    <p>
      <button id="settings_back">Done</button>
    </p>
  </div>
  <h3>Status:
    <span id="status">Disconnected</span>
  </h3>
  <p>Log:</p>
  <div class="wrapper">
    <textarea cols="30" rows="15" id="log"></textarea>
  </div>
</body>
</html>
